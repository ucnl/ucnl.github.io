| ![logo](https://ucnl.github.io/documentation/sm_logo.png) |  |
| :---: | ---: |
| [www.unavlab.com](https://www.unavlab.com/) <br/> [support@unavlab.com](mailto:support@unavlab.com) | **RedLINE** - семейство устройств гидроакустической связи <br/> Протокол информационного сопряжения |
  
  
  
# RedLINE <br/> протокол информационного сопряжения

<div style="page-break-after: always;"></div>

## Содержание
- [1. Введение](#1-%D0%B2%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5)  
  - [1.1. Протокол физического уровня](#11-%D0%BF%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB-%D1%84%D0%B8%D0%B7%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B3%D0%BE-%D1%83%D1%80%D0%BE%D0%B2%D0%B5%D0%BD%D1%8F)
  - [1.2. Стандарт протокола диалогового уровня NMEA0183](#12-%D1%81%D1%82%D0%B0%D0%BD%D0%B4%D0%B0%D1%80%D1%82-%D0%BF%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB%D0%B0-%D0%B4%D0%B8%D0%B0%D0%BB%D0%BE%D0%B3%D0%BE%D0%B2%D0%BE%D0%B3%D0%BE-%D1%83%D1%80%D0%BE%D0%B2%D0%BD%D1%8F-nmea0183)
- [2. Система команд TNT для ГА модемов RedLINE]()  
   - [2.1. IC_D2H_ACK - реакция устройства](#21-ic_d2h_ack)
   - [2.2. IC_H2D_SETTINGS_WRITE - запись новых настроек](#22-ic_h2d_settings_write)
   - [2.3. IC_H2D_RC_REQUEST - кодовый запрос удаленному абоненту](#23-ic_h2d_rc_request)
   - [2.4. IC_D2H_RC_RESPONSE - ответ удаленного абонента](#24-ic_d2h_rc_response)
   - [2.5. IC_D2H_RC_TIMEOUT - превышен интервал ожидавния ответа удаленного абонента](#25-ic_d2h_rc_timeout)
   - [2.6. IC_D2H_RC_ASYNC_IN - входящее кодовое сообщение от удаленного абонента](#26-ic_d2h_rc_async_in)
   - [2.7. IC_H2D_AMB_DTA_CFG - настройка выдачи параметров окружающей среды](#27-ic_h2d_amb_dta_cfg)
   - [2.8. IC_H2D_AMB_DTA - параметры окружающей среды и питания](#28-ic_h2d_amb_dta)
   - [2.9. IC_H2D_DINFO_GET - запрос информации об устройстве](#29-ic_h2d_dinfo_get)
   - [2.10. IC_D2H_DINFO - информация об устройстве](#210-ic_d2h_dinfo)
- [3. Командный режим](#3-%D0%BA%D0%BE%D0%BC%D0%B0%D0%BD%D0%B4%D0%BD%D1%8B%D0%B9-%D1%80%D0%B5%D0%B6%D0%B8%D0%BC)
- [4. Идентификаторы](#4-%D0%B8%D0%B4%D0%B5%D0%BD%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%82%D0%BE%D1%80%D1%8B)
   - [4.1. Коды ошибок](#41-%D0%BA%D0%BE%D0%B4%D1%8B-%D0%BE%D1%88%D0%B8%D0%B1%D0%BE%D0%BA)
   - [4.2. Удаленные команды](#42-%D1%83%D0%B4%D0%B0%D0%BB%D0%B5%D0%BD%D0%BD%D1%8B%D0%B5-%D0%BA%D0%BE%D0%BC%D0%B0%D0%BD%D0%B4%D1%8B)
   
<div style="page-break-after: always;"></div>

## 1. Введение
### 1.1. Протокол физического уровеня
   
Гидроакустические модемы **uWAVE** поддерживают информационное сопряжение при помощи стандарта физического уровня RS-232 для 
асинхронного интерфейса (UART) c напряжением линии данных 3.3В. Подключение производится при помощи четырехпроводного кабеля, 
с жилами Tx (трансмиттер), Rx (ресивер), Vcc (питание)  и GND (земля). Без применения дополнительных повторителей и преобразователей 
интерфейса максимальная длинна шины данных, для которой гарантируется корректная работа интерфейса, составляет не более 2 метров.  

Настройки порта подключения по умолчанию<sup>[1](#footnote1)</sup>:  
> _Baudrate: 9600 bit/s_  
> _Data bits: 8_  
> _Stop bits: 1_  
> _Parity: No_  
> _Hardware flow control: No_  

>**ВНИМАНИЕ!**
>_Питание модемов осуществляется от источника постоянного тока 5 Вольт, при этом напряжение линии данных составляет 3.3 В._

### 1.2. Стандарт протокола диалогового уровня NMEA0183
Стандарт NMEA0183 описывает формат текстовых (ASCII) сообщений диалогового уровня.  

Пример сообщения:  **`$PTNT0,0*hh<СR><LF>`**  

Основные элементы посылки (сообщения, sentence) NMEА0183:
* '$' - начало сообщения,
* 'P' - Proprietary, проприетарный код
* 'TNT' - трехбуквенный идентификатор производителя
* '0' - идентификатор сообщения
* ',' - запятая (разделитель параметров)  
* '0' - параметр (в данном случае код ошибки)
* '*' - разделитель контрольной суммы
* 'hh' - контрольная сумма в шестнадцатеричном формате (например FF, 01). Рассчитывается как побитовый XOR всех байт между '$' и '*'.
* \<CR\>\<LF\> - конец сообщения (перевод строки)
________
<a name="footnote1"><sup>1</sup> Указанные параметры могут быть изменены по запросу</a>

<div style="page-break-after: always;"></div>

## 2. Система команд TNT для ГА модемов RedLINE
Префикс **D2H** в наименовании сообщений означает, что оно передается от устройства (Device) к управляющей системе (Host).
Префикс **H2D** в наименовании сообщений означает, что оно передается от управляющей системы (Host) к устройству (Device).

### 2.1. IC_D2H_ACK
Сообщение IC_D2H_ACK - реакция устройства на поступивший от управляющей системы запрос  

Формат сообщения: **`$PTNT0,x*hh<CR><LF>`**  

| Поле/Параметр |	Описание |
| :--- | :--- |
| $	| Начало сообщения '$' |
| PTNT	| TNT |
| 0	| Идентификатор сообщения |
| errCode	| Error code \([см. 4.1](#41-%D0%BA%D0%BE%D0%B4%D1%8B-%D0%BE%D1%88%D0%B8%D0%B1%D0%BE%D0%BA)\) |
| *	| Разделитель контрольной суммы NMEA |
| hh	| Контрольная сумма NMEA |
| \<CR\>\<LF\> | Конец сообщения |

