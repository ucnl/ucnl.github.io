| ![logo](https://ucnl.github.io/documentation/sm_logo.png) |  |
| :---: | ---: |
| [www.unavlab.com](https://www.unavlab.com/) <br/> [support@unavlab.com](mailto:support@unavlab.com) | **RedWAVE** - гидроакустическая навигационная система <br/> Протокол информационного сопряжения c навигационным приемником RedNODE |
  
  
  
# RedWAVE <br/> протокол информационного сопряжения c навигационными приемниками RedNODE

<div style="page-break-after: always;"></div>

## Содержание
- [1. Введение](#1-%D0%B2%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5)  
  - [1.1. Протокол физического уровня](#11-%D0%BF%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB-%D1%84%D0%B8%D0%B7%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B3%D0%BE-%D1%83%D1%80%D0%BE%D0%B2%D0%B5%D0%BD%D1%8F)
  - [1.2. Стандарт протокола диалогового уровня NMEA0183](#12-%D1%81%D1%82%D0%B0%D0%BD%D0%B4%D0%B0%D1%80%D1%82-%D0%BF%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB%D0%B0-%D0%B4%D0%B8%D0%B0%D0%BB%D0%BE%D0%B3%D0%BE%D0%B2%D0%BE%D0%B3%D0%BE-%D1%83%D1%80%D0%BE%D0%B2%D0%BD%D1%8F-nmea0183)

   
<div style="page-break-after: always;"></div>

## 1. Введение
### 1.1. Протокол физического уровеня
   
Гидроакустические навигационные приемники **[RedNODE](RedNODE_Specification_ru.md)** поддерживают информационное сопряжение при помощи 
стандарта физического уровня RS-232 для асинхронного интерфейса (UART) c напряжением линии данных 3.3В. Подключение производится при помощи 
четырехпроводного кабеля, с жилами Tx (трансмиттер), Rx (ресивер), Vcc (питание)  и GND (земля). Без применения дополнительных повторителей 
и преобразователей интерфейса максимальная длинна шины данных, для которой гарантируется корректная работа интерфейса, составляет не более 2 метров.  

Настройки порта подключения по умолчанию<sup>[1](#footnote1)</sup>:  
> _Baudrate: 9600 bit/s_  
> _Data bits: 8_  
> _Stop bits: 1_  
> _Parity: No_  
> _Hardware flow control: No_  

>**ВНИМАНИЕ!**
>_Питание модемов осуществляется от источника постоянного тока 12 Вольт, при этом напряжение линии данных составляет 3.3 В._

### 1.2. Стандарт протокола диалогового уровня NMEA0183
Стандарт NMEA0183 описывает формат текстовых (ASCII) сообщений диалогового уровня.  

Пример сообщения:  **`$PTNT0,1,0*hh<СR><LF>`**  

Основные элементы посылки (сообщения, sentence) NMEА0183:
* '$' - начало сообщения,
* 'P' - Proprietary, проприетарный код
* 'TNT' - трехбуквенный идентификатор производителя
* '0' - идентификатор сообщения
* ',' - запятая (разделитель параметров)  
* '*' - разделитель контрольной суммы
* 'hh' - контрольная сумма в шестнадцатеричном формате (например FF, 01). Рассчитывается как побитовый XOR всех байт между '$' и '*'.
* \<CR\>\<LF\> - конец сообщения (перевод строки)
________
<a name="footnote1"><sup>1</sup> Указанные параметры могут быть изменены по запросу</a>

<div style="page-break-after: always;"></div>

## 2. Система команд TNT и стандартные сообщения NMEA0183
Префикс **D2H** в наименовании сообщений означает, что оно передается от устройства (Device) к управляющей системе (Host).
Префикс **H2D** в наименовании сообщений означает, что оно передается от управляющей системы (Host) к устройству (Device).

### 2.1. Оснвные и частоупотребимые сообщения

#### 2.1.1. GGA
Стандартное сообщение NMEA0183 - Global positioning system fix data.

Формат сообщения: **`$GNGGA,hhmmss.sss,ddmm.mmm,N|S,yyymm.mmm,E|W,x,xx,x.x,x.x,M,x.x,M,xx,xxxx*hh<CR><LF>`**  

| № | Поле/Параметр |	Описание |
| :--- | :--- | :--- |
| | $	| Начало сообщения '$' |
| | GN | Стандартный источник данных - Global navigation |
| | GGA |	Стандартный идентификатор сообщения - Globap positioning system fix data |
| 1 | UTC Time |	UTC, ччммсс.ссс |
| 2 | Latitude |	Географическая широта, ddmm.mmmmmm |
| 3 | N|S | Идентификатор полушария, N - северное, S - южное |
| 4 | Longitude |	Географическая долгота, dddmm.mmmmmm |
| 5 | E|W | Идентификатор полушария, E - восточное, W - западное |
| 6 | Fix Type | Тип навигационного решения | 
| 7 | Satellites in view | Число доступных спутников (в RedWAVE всегда равно 4) |
| 8 | HDOP | Horizontal dilution of precision, метры. (в RedWAVE данное поле передает радиальную ошибку, значение функции невязки в конце решения) |
| 9 | Altitude | Altitude, метры. (в RedWAVE данное поле передает глубину, т.е. высоту со знаком "-") |
| 10 | M |	М - метры |
| 11 | Geoidal separation | Поле не поддерживается и остается пустым |
| 12 | Age of data |  Поле не поддерживается и остается пустым |
| 13 | Reference station ID | Поле не поддерживается и остается пустым |
| | *	| Разделитель контрольной суммы NMEA |
| | hh	| Контрольная сумма NMEA |
| | \<CR\>\<LF\> | Конец сообщения |

#### 2.1.2. RMC
Стандартное сообщение NMEA0183 - Recommended minimum, sentence 'C'.

Формат сообщения: **`$GNRMC,hhmmss.sss,A|V,ddmm.mmm,N|S,dddmm.mmm,E|W,x.x,x.x,ddmmyy,,,A|D|V*hh<CR><LF>`**  

| № | Поле/Параметр |	Описание |
| :--- | :--- | :--- |
|  | $	| Начало сообщения '$' |
|  | GN | Стандартный источник данных - Global navigation |
|  | RMC | Стандартный идентификатор сообщения - Recommended minimum, sentence 'C' |
| 1 | UTC Time |	UTC, ччммсс.ссс |
| 2 | Data quality indicator |	A - данные верны |
| 3 | Latitude |	Географическая широта, ddmm.mmmmmm |
| 4 | N|S | Идентификатор полушария, N - северное, S - южное |
| 5 | Longitude |	Географическая долгота, dddmm.mmmmmm |
| 6 | E|W | Идентификатор полушария, E - восточное, W - западное |
| 7 | Speed |	Поле не поддерживается |
| 8 | Course | Поле не поддерживается |
| 9 | Date | Поле не поддерживается |
| 10 | Magnetic variation | Поле не поддерживается |
| 11 | E|W | Поле не поддерживается |
| 12 | A | Режим, A - GNSS |
| *	| Разделитель контрольной суммы NMEA |
| hh	| Контрольная сумма NMEA |
| \<CR\>\<LF\> | Конец сообщения |

#### 2.1.3. MTW
Стандартное сообщение NMEA0183 - Mean water temperature (Температура воды).

Формат сообщения: **`$GNMTW,x.x,C*hh<CR><LF>`**  

| № | Поле/Параметр |	Описание |
| :--- | :--- | :--- |
|  | $	| Начало сообщения '$' |
|  | GN | Стандартный источник данных - Global navigation |
|  | MTW | Стандартный идентификатор сообщения - Mean temperature of water |
| 1 | Temperature	| Температура воды, ˚C
| 2 | C	| C - Celsius |
| *	| Разделитель контрольной суммы NMEA |
| hh	| Контрольная сумма NMEA |
| \<CR\>\<LF\> | Конец сообщения |
















IC_D2H_ACK
Сообщение IC_D2H_ACK - реакция устройства на поступивший от управляющей системы запрос  

Формат сообщения: **`$PTNT0,x*hh<CR><LF>`**  

| Поле/Параметр |	Описание |
| :--- | :--- |
| $	| Начало сообщения '$' |
| PTNT	| TNT |
| 0	| Идентификатор сообщения |
| cmdID	| Идентификатор обрабатываемой команды (на которую устройство отреагировало) |
| errCode	| Error code \([см.x.x]()\) |
| *	| Разделитель контрольной суммы NMEA |
| hh	| Контрольная сумма NMEA |
| \<CR\>\<LF\> | Конец сообщения |

