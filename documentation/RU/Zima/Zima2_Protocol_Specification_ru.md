[Главная](/README_RU) ❯ [Гидроакустические навигационные и трекинговые системы](/navigation_and_tracking_systems_ru) ❯ **Zima2 USBL: Протокол информационного сопряжения**

<div style="page-break-after: always;"></div>

| ![logo](/documentation/sm_logo.png) |  |
| :---: | ---: |
| [www.unavlab.com](https://www.unavlab.com/) <br/> [support@unavlab.com](mailto:support@unavlab.com) | **Zima2 USBL** - гидроакустическая навигационная система <br/> Протокол информационного сопряжения |

# Zima2 USBL <br/> Протокол информационного сопряжения

<div style="page-break-after: always;"></div>

## Содержание
- [1. Введение](#1-%D0%B2%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5)  
  - [1.1. Протокол физического уровня](#11-%D0%BF%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB-%D1%84%D0%B8%D0%B7%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B3%D0%BE-%D1%83%D1%80%D0%BE%D0%B2%D0%B5%D0%BD%D1%8F)
  - [1.2. Стандарт протокола диалогового уровня NMEA0183](#12-%D1%81%D1%82%D0%B0%D0%BD%D0%B4%D0%B0%D1%80%D1%82-%D0%BF%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB%D0%B0-%D0%B4%D0%B8%D0%B0%D0%BB%D0%BE%D0%B3%D0%BE%D0%B2%D0%BE%D0%B3%D0%BE-%D1%83%D1%80%D0%BE%D0%B2%D0%BD%D1%8F-nmea0183)
- [2. Система команд AZM](#2-%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0-%D0%BA%D0%BE%D0%BC%D0%B0%D0%BD%D0%B4-azm)  
   - [2.1. IC_D2H_ACK - реакция устройства](#21-ic_d2h_ack)
     
- [3. Таблицы идентификаторов](#3-%D1%82%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D1%8B-%D0%B8%D0%B4%D0%B5%D0%BD%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%82%D0%BE%D1%80%D0%BE%D0%B2)
  


<div style="page-break-after: always;"></div>

## 1. Введение
### 1.1. Протокол физического уровеня

Устройства системы [Zima2 USBL](Zima2_DataBrief_ru.md) поддерживают информационное сопряжение при помощи стандарта физического уровня RS-232 
для асинхронного интерфейса (UART) c напряжением линии данных 3.3В. Подключение производится при помощи четырехпроводного кабеля, с жилами Tx
(трансмиттер), Rx (ресивер), Vcc (питание) и GND (земля). Без применения дополнительных повторителей и преобразователей интерфейса 
максимальная длинна шины данных, для которой гарантируется корректная работа интерфейса, составляет не более 2 метров.

Настройки порта подключения по умолчанию<sup>[1](#footnote1)</sup>:  
> _Baudrate: 9600 bit/s_  
> _Data bits: 8_  
> _Stop bits: 1_  
> _Parity: No_  
> _Hardware flow control: No_  

>**ВНИМАНИЕ!**
>_У устройств без преобразователей интерфейса напряжение линии данных составляет 3.3 В._

### 1.2. Стандарт протокола диалогового уровня NMEA0183
Стандарт NMEA0183 описывает формат текстовых (ASCII) сообщений диалогового уровня.  

Пример сообщения:  **`$PAZM0,[x],x*hh<СR><LF>`**  

Основные элементы посылки (сообщения, sentence) NMEА0183:
* '$' - начало сообщения,
* 'P' - Proprietary, проприетарный код
* 'AZM' - трехбуквенный идентификатор
* '0' - идентификатор сообщения
* '[0]
* ',' - запятая (разделитель параметров)  
* '*' - разделитель контрольной суммы
* 'hh' - контрольная сумма в шестнадцатеричном формате (например FF, 01). Рассчитывается как побитовый XOR всех байт между '$' и '*'.
* \<CR\>\<LF\> - конец сообщения (перевод строки)
________
<a name="footnote1"><sup>1</sup> Указанные параметры могут быть изменены по запросу</a>

<div style="page-break-after: always;"></div>

## 2. Система команд AZM
Префикс **D2H** в наименовании сообщений означает, что оно передается от устройства (Device) к управляющей системе (Host).
Префикс **H2D** в наименовании сообщений означает, что оно передается от управляющей системы (Host) к устройству (Device).
Префикс **D2D** в наименовании сообщений означает, что оно может передаваться в обе стороны: как от устройства к управляющей системе, так и наоборот.

### 2.1. IC_D2H_ACK
Сообщение IC_D2H_ACK - реакция устройства на поступивший от управляющей системы запрос.  

Формат сообщения: 
**`
$PAZM0,[x],x*hh<CR><LF>
`**

| № | Поле/параметр | Описание |
| :--- | :--- | :--- |
| | $	| начало сообщения '$' |
| | PAZM | система команд AZM |
| | 0	| идентификатор сообщения |
| 1 | cmdID | Идентификатор команды, на которую устройство отреагировало |
| 2 | result | Код ошибки \([см. 3.2.]()\) |
| | *	| разделитель контр. суммы NMEA |
| | hh | контрольная сумма NMEA |
| | \<CR\>\<LF\> | конец сообщения |

### 2.2. IC_D2D_STRSTP
Сообщение IC_D2D_STRSTP - сообщение для задания параметров запроса маяков-ответчиков.

Передается от управляющей системы к пеленгационной станции для:
- начала опроса маяков-ответчиков
- останова опроса маяков-ответчиков
- изменения параметров опроса (маски адресов, максимальной дистанции, солености воды)

Передается от пеленгационной станции к управляющей системе как эхо-подтверждение о принятии команды.

Формат сообщения: 
**`
$PAZM0,x,x*hh<CR><LF>
`**

| № | Поле/параметр | Описание |
| :--- | :--- | :--- |
| | $	| начало сообщения '$' |
| | PAZM | система команд AZM |
| | 0	| идентификатор сообщения |
| 1 | cmdID | Идентификатор команды, на которую устройство отреагировало |
| 2 | result | Код ошибки \([см. 3.2.]()\) |
| | *	| разделитель контр. суммы NMEA |
| | hh | контрольная сумма NMEA |
| | \<CR\>\<LF\> | конец сообщения |


<div style="page-break-after: always;"></div>

## 3. Таблицы идентификаторов



<div style="page-break-after: always;"></div>
