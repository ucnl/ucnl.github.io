[Главная](/README_RU) ❯ [Гидроакустические навигационные и трекинговые системы](/navigation_and_tracking_systems_ru) ❯ **WAYU: Описание протокола сопряжения**

<div style="page-break-after: always;"></div>

| ![logo](/documentation/sm_logo.png) |  |
| :---: | ---: |
| [www.unavlab.com](https://www.unavlab.com/) <br/> [support@unavlab.com](mailto:support@unavlab.com) | **WAYU** - Гидроакустическая трекинговая система <br/> Описание протокола сопряжения |

# WAYU <br/> Протокол информационного сопряжения

<div style="page-break-after: always;"></div>

## Содержание

<div style="page-break-after: always;"></div>

## 1. Введение

Приложение [WAYU](https://github.com/ucnl/WAYU) может передавать навигационные данные во внешние системы двумя разными способами:

- **Первый** способ подразумевает **соединение через последовательный порт**. В этом случае приложение эмулирует протокол обычных GNSS-приемников (сообщения RMC и GGA), передавая во внешнюю систему вычисленное местоположение пингера.
- **Второй** способ реализуется при помощи **соединения по протоколу UDP**. В этом случае приложение передает полный набор навигационной информации, включая местоположения буев, состояние их встроенных источников питания.

Оба способа могут быть задействованы в любом порядке и сочетании.

## 2. Соединение по последовательному порту

При соединении по последовательному порту приложение использует стандартные сообщения протокола NMEA0183, применяемые для передаче данных GNSS-приемниками.
Стоит помнить, что в виду ограничений, накладываемых стандартными сообщениями, доступен только ограниченный набор данных. 
Этот способ удобен для передачи данных в какой-либо плоттер или картографическое приложение, рассчитаное на работу с обычными GNSS-приемниками.

Приложение использует стандартные сообщения **GGA** и **RMC**, формат которых описан ниже.

#### 2.1. GGA
Стандартное сообщение NMEA0183 - Global positioning system fix data.

Формат сообщения: **`$GNGGA,hhmmss.sss,ddmm.mmm,N|S,yyymm.mmm,E|W,x,xx,x.x,x.x,M,x.x,M,xx,xxxx*hh<CR><LF>`**  

| № | Поле/Параметр |	Описание |
| :--- | :--- | :--- |
| | $	| Начало сообщения '$' |
| | GN | Стандартный источник данных - Global navigation |
| | GGA |	Стандартный идентификатор сообщения - Globap positioning system fix data |
| 1 | UTC Time |	UTC, ччммсс.ссс |
| 2 | Latitude |	Географическая широта, ddmm.mmmmmm |
| 3 | N|S | Идентификатор полушария, N - северное, S - южное |
| 4 | Longitude |	Географическая долгота, dddmm.mmmmmm |
| 5 | E|W | Идентификатор полушария, E - восточное, W - западное |
| 6 | Fix Type | Тип навигационного решения | 
| 7 | Satellites in view | Число доступных спутников (в этом поле указывается число буев: 4) |
| 8 | HDOP | Horizontal dilution of precision, метры. (Поле не поддерживается и оставляется пустым) |
| 9 | Altitude | Altitude, метры. (В этом поле передается глубина антенн буев) |
| 10 | M |	М - метры |
| 11 | Geoidal separation | Поле не поддерживается и остается пустым |
| 12 | Age of data |  Поле не поддерживается и остается пустым |
| 13 | Reference station ID | Поле не поддерживается и остается пустым |
| | *	| Разделитель контрольной суммы NMEA |
| | hh	| Контрольная сумма NMEA |
| | \<CR\>\<LF\> | Конец сообщения |

#### 2.1.2. RMC
Стандартное сообщение NMEA0183 - Recommended minimum, sentence 'C'.

Формат сообщения: **`$GNRMC,hhmmss.sss,A|V,ddmm.mmm,N|S,dddmm.mmm,E|W,x.x,x.x,ddmmyy,,,A|D|V*hh<CR><LF>`**  

| № | Поле/Параметр |	Описание |
| :--- | :--- | :--- |
|  | $	| Начало сообщения '$' |
|  | GN | Стандартный источник данных - Global navigation |
|  | RMC | Стандартный идентификатор сообщения - Recommended minimum, sentence 'C' |
| 1 | UTC Time |	UTC, ччммсс.ссс |
| 2 | Data quality indicator |	A - данные верны |
| 3 | Latitude |	Географическая широта, ddmm.mmmmmm |
| 4 | N|S | Идентификатор полушария, N - северное, S - южное |
| 5 | Longitude |	Географическая долгота, dddmm.mmmmmm |
| 6 | E|W | Идентификатор полушария, E - восточное, W - западное |
| 7 | Speed |	Поле не поддерживается |
| 8 | Course | Курс (в этом поле передается курс, вычисленный по нескольким положениям) |
| 9 | Date | Поле не поддерживается |
| 10 | Magnetic variation | Поле не поддерживается |
| 11 | E|W | Поле не поддерживается |
| 12 | A | Режим, A - GNSS |
|  | *	| Разделитель контрольной суммы NMEA |
|  | hh	| Контрольная сумма NMEA |
|  | \<CR\>\<LF\> | Конец сообщения |

## 3. Соединение по протоколу UDP

### 3.1. Формат сообщений

При данном способе приложение будет один раз в секунду отправлять через UDP-соединение ASCII-строку, где поля параметров разделены запятыми. 

Для задействования данного способа в настройках приложения необходимо установить галочку **Use UDP**, а в соответствующей группе элементов управления указать требуемый IP-адрес и номер порта.

Общий формат сообщения следующий:

`@WAYU,sntID[,param_1[,param_N]]<CR><LF>`
  
- `@` - признак начала сообщения
- `WAYU`  - идентификатор отправителя
- `sntID` - идентификатор сообщения
- `param_1 ... param_N` - параметры, разделенные запятой
- `<CR><LF>` - символы перевода строки (0x0D 0x0A) - признак конца сообщения

Сообщения имеют фиксированный набор полей. Если значение, соотвествующее данному полю не может быть передано в данный момент (данные отсутствуют), то поле остается пустым.

Параметры и идентификаторы **не должны содержать** внутри:
- символ (признак) начала сообщения `@`
- символ (признак) конца сообщения `<CR><LF>`
- запятые `,`

### 3.2. Сообщение 1

Пример пустого сообщения:  
`@WAYU,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,<CR><LF>`

Пример сообщения в процессе работы:   `@WAYU,1,,,,48.976073,44.740138,True,1.7,48.975159,44.741762,True,1.5,48.976304,44.742986,True,1.3,48.977194,44.741364,True,1.0,48.976187,44.741481,NaN,2.9,1.0,214.4,,,,,Excellent,Good,0.9
`

#### Таблица 3.2.1 - Список параметров сообщения

| № | Параметр | Формат данных | Ед. <br/> измерения | Диапазон |
| :--- | :--- | :--- | :--- | :--- |
| 1 | extGNSSLat | вещественное число | ° | -90 .. 90 |
| 2 | extGNSSLon | вещественное число | ° | -180 .. 180 |
| 3 | extGNSSFixAge | вещественное число | сек | ≥ 0 |
| 4 | b1Lat | вещественное число | ° | -90 .. 90 |
| 5 | b1Lon | вещественное число | ° | -180 .. 180 |
| 6 | b1BatState | логическое значение | | true, false |
| 7 | b1DataAge | вещественное число | сек | ≥ 0 |
| 8 | b2Lat | вещественное число | ° | -90 .. 90 |
| 9 | b2Lon | вещественное число | ° | -180 .. 180 |
| 10 | b2BatState | логическое значение | | true, false |
| 11 | b2DataAge | вещественное число | сек | ≥ 0 |
| 12 | b3Lat | вещественное число | ° | -90 .. 90 |
| 13 | b3Lon | вещественное число | ° | -180 .. 180 |
| 14 | b3BatState | логическое значение | | true, false |
| 15 | b3DataAge | вещественное число | сек | ≥ 0 | 
| 16 | b4Lat | вещественное число | ° | -90 .. 90 |
| 17 | b4Lon | вещественное число | ° | -180 .. 180 |
| 18 | b4BatState | логическое значение | | true, false |
| 19 | b4DataAge | вещественное число | сек | ≥ 0 | 
| 20 | tLat | вещественное число | ° | -90 .. 90 |
| 21 | tLon | вещественное число | ° | -180 .. 180 |
| 22 | tDpt | вещественное число | м | |
| 23 | tRErr | вещественное число | м | ≥ 0 |
| 24 | tFixAge | вещественное число | сек | ≥ 0 |
| 25 | tCourseEstimated | вещественное число | ° | 0 .. 360 |
| 26 | tDistance | вещественное число | м | ≥ 0 |
| 27 | tFwdAzimuth | вещественное число | ° | 0 .. 360 |
| 28 | tRevAzimuth | вещественное число | ° | 0 .. 360 |
| 29 | DOPState | перечисляемый тип | | |
| 30 | TBAState | перечисляемый тип | | |
| 31 | DOPTBAStateAge | вещественное число | сек | ≥ 0 |

#### Таблица 3.2.2 - Описание параметров сообщения

| № | Параметр | Описание |
| :--- | :--- | :--- | 
| 1 | extGNSSLat | Широта, по данным внешнего GNSS-приемника |
| 2 | extGNSSLon |  Долгота, по данным внешнего GNSS-приемника |
| 3 | extGNSSFixAge | Возраст предыдуших двух полей |
| 4 | b1Lat | Широта (Буй №1) |
| 5 | b1Lon | Долгота (Буй №1) |
| 6 | b1BatState | Состоянии встроенного источника питания (Буй №1) |
| 7 | b1DataAge | Возраст предыдущих трех полей |
| 8 | b2Lat | Широта (Буй №2) |
| 9 | b2Lon | Долгота (Буй №2) |
| 10 | b2BatState | Состоянии встроенного источника питания (Буй №2) |
| 11 | b2DataAge | Возраст предыдущих трех полей |
| 12 | b3Lat | Широта (Буй №3) |
| 13 | b3Lon | Долгота (Буй №3) |
| 14 | b3BatState | Состоянии встроенного источника питания (Буй №3) |
| 15 | b3DataAge | Возраст предыдущих трех полей |
| 16 | b4Lat | Широта (Буй №4) |
| 17 | b4Lon | Долгота (Буй №4) |
| 18 | b4BatState | Состоянии встроенного источника питания (Буй №4) |
| 19 | b4DataAge | Возраст предыдущих трех полей |
| 20 | tLat | Вычисленная положение пингера: широта |
| 21 | tLon | Вычисленная положение пингера: долгота |
| 22 | tDpt | Глубина пингера (не используется) |
| 23 | tRErr | Радиальная ошибка при вычислении положения пингера  |
| 24 | tFixAge | Возраст предыдущих четырех полей |
| 25 | tCourseEstimated | Вычисленный (экстраполяция по нескольким точкам) курс движения пингера (только при наличии внегнего GNSS) |
| 26 | tDistance | Вычисленная дальность до пингера (только при наличии внегнего GNSS) |
| 27 | tFwdAzimuth | Вычисленный азимут на пингер (только при наличии внегнего GNSS) |
| 28 | tRevAzimuth | Вычисленный азимут от пингера на базовую станцию (только при наличии внегнего GNSS) |
| 29 | tRelAge | Возраст предыдущих четырех полей |
| 29 | DOPState | Геометрический фактор (Dilution Of Precision) |
| 30 | TBAState | Качество расположения пингера относительно буев |
| 31 | DOPTBAStateAge | Возраст предыдущих двух полей |

<div style="page-break-after: always;"></div>
