[Главная](/README_RU) ❯ [Гидроакустические навигационные и трекинговые системы](/navigation_and_tracking_systems_ru) ❯ **WAYU: Описание протокола сопряжения**

<div style="page-break-after: always;"></div>

| ![logo](/documentation/sm_logo.png) |  |
| :---: | ---: |
| [www.unavlab.com](https://www.unavlab.com/) <br/> [support@unavlab.com](mailto:support@unavlab.com) | **WAYU** - Гидроакустическая трекинговая система <br/> Описание протокола сопряжения |

# WAYU <br/> Протокол информационного сопряжения

<div style="page-break-after: always;"></div>

## Содержание

<div style="page-break-after: always;"></div>

## 1. Введение

Приложение [WAYU](https://github.com/ucnl/WAYU) может передавать навигационные данные во внешние системы двумя разными способами:

- **Первый** способ подразумевает **соединение через последовательный порт**. В этом случае приложение эмулирует протокол обычных GNSS-приемников (сообщения RMC и GGA), передавая во внешнюю систему вычисленное местоположение пингера.
- **Второй** способ реализуется при помощи **соединения по протоколу UDP**. В этом случае приложение передает полный набор навигационной информации, включая местоположения буев, состояние их встроенных источников питания.

Оба способа могут быть задействованы в любом порядке и сочетании.

## 2. Соединение по последовательному порту

При соединении по последовательному порту приложение использует стандартные сообщения протокола NMEA0183, применяемые для передаче данных GNSS-приемниками.
Стоит помнить, что в виду ограничений, накладываемых стандартными сообщениями, доступен только ограниченный набор данных. 
Этот способ удобен для передачи данных в какой-либо плоттер или картографическое приложение, рассчитаное на работу с обычными GNSS-приемниками.

Приложение использует стандартные сообщения **GGA** и **RMC**, формат которых описан ниже.

#### 2.1. GGA
Стандартное сообщение NMEA0183 - Global positioning system fix data.

Формат сообщения: **`$GNGGA,hhmmss.sss,ddmm.mmm,N|S,yyymm.mmm,E|W,x,xx,x.x,x.x,M,x.x,M,xx,xxxx*hh<CR><LF>`**  

| № | Поле/Параметр |	Описание |
| :--- | :--- | :--- |
| | $	| Начало сообщения '$' |
| | GN | Стандартный источник данных - Global navigation |
| | GGA |	Стандартный идентификатор сообщения - Globap positioning system fix data |
| 1 | UTC Time |	UTC, ччммсс.ссс |
| 2 | Latitude |	Географическая широта, ddmm.mmmmmm |
| 3 | N|S | Идентификатор полушария, N - северное, S - южное |
| 4 | Longitude |	Географическая долгота, dddmm.mmmmmm |
| 5 | E|W | Идентификатор полушария, E - восточное, W - западное |
| 6 | Fix Type | Тип навигационного решения | 
| 7 | Satellites in view | Число доступных спутников (в этом поле указывается число буев: 4) |
| 8 | HDOP | Horizontal dilution of precision, метры. (Поле не поддерживается и оставляется пустым) |
| 9 | Altitude | Altitude, метры. (В этом поле передается глубина антенн буев) |
| 10 | M |	М - метры |
| 11 | Geoidal separation | Поле не поддерживается и остается пустым |
| 12 | Age of data |  Поле не поддерживается и остается пустым |
| 13 | Reference station ID | Поле не поддерживается и остается пустым |
| | *	| Разделитель контрольной суммы NMEA |
| | hh	| Контрольная сумма NMEA |
| | \<CR\>\<LF\> | Конец сообщения |

#### 2.1.2. RMC
Стандартное сообщение NMEA0183 - Recommended minimum, sentence 'C'.

Формат сообщения: **`$GNRMC,hhmmss.sss,A|V,ddmm.mmm,N|S,dddmm.mmm,E|W,x.x,x.x,ddmmyy,,,A|D|V*hh<CR><LF>`**  

| № | Поле/Параметр |	Описание |
| :--- | :--- | :--- |
|  | $	| Начало сообщения '$' |
|  | GN | Стандартный источник данных - Global navigation |
|  | RMC | Стандартный идентификатор сообщения - Recommended minimum, sentence 'C' |
| 1 | UTC Time |	UTC, ччммсс.ссс |
| 2 | Data quality indicator |	A - данные верны |
| 3 | Latitude |	Географическая широта, ddmm.mmmmmm |
| 4 | N|S | Идентификатор полушария, N - северное, S - южное |
| 5 | Longitude |	Географическая долгота, dddmm.mmmmmm |
| 6 | E|W | Идентификатор полушария, E - восточное, W - западное |
| 7 | Speed |	Поле не поддерживается |
| 8 | Course | Курс (в этом поле передается курс, вычисленный по нескольким положениям) |
| 9 | Date | Поле не поддерживается |
| 10 | Magnetic variation | Поле не поддерживается |
| 11 | E|W | Поле не поддерживается |
| 12 | A | Режим, A - GNSS |
|  | *	| Разделитель контрольной суммы NMEA |
|  | hh	| Контрольная сумма NMEA |
|  | \<CR\>\<LF\> | Конец сообщения |

## 3. Соединение по протоколу UDP

### 3.1. Формат сообщений

При данном способе приложение будет один раз в секунду отправлять через UDP-соединение ASCII-строку, где поля параметров разделены запятыми. 

Для задействования данного способа в настройках приложения необходимо установить галочку **Use UDP**, а в соответствующей группе элементов управления указать требуемый IP-адрес и номер порта.

Общий формат сообщения следующий:

`@WAYU,sntID[,param_1[,param_N]]<CR><LF>`
  
- `@` - признак начала сообщения
- `WAYU`  - идентификатор отправителя
- `sntID` - идентификатор сообщения
- `param_1 ... param_N` - параметры, разделенные запятой
- `<CR><LF>` - символы перевода строки (0x0D 0x0A) - признак конца сообщения

Сообщения имеют фиксированный набор полей. Если значение, соотвествующее данному полю не может быть передано в данный момент (данные отсутствуют), то поле остается пустым.

Параметры и идентификаторы **не должны содержать** внутри:
- символ (признак) начала сообщения `@`
- символ (признак) конца сообщения `<CR><LF>`
- запятые `,`

### 3.2. Сообщение 1

Пример пустого сообщения:  
`@WAYU,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,<CR><LF>`

Пример сообщения в процессе работы:   `@WAYU,1,,,,48.976073,44.740138,True,1.7,48.975159,44.741762,True,1.5,48.976304,44.742986,True,1.3,48.977194,44.741364,True,1.0,48.976187,44.741481,NaN,2.9,1.0,214.4,,,,,Excellent,Good,0.9<CR><LF>` 

#### Таблица 3.2.1 - Типы данных и диапазоны параметров

| № | Параметр | Формат данных | Ед. <br/> измерения | Диапазон |
| :--- | :--- | :--- | :--- | :--- |
| 1  | SntID | целое число | | ≥ 0 |
| 2  | extGNSSLat | вещественное число | ° | -90 .. 90 |
| 3  | extGNSSLon | вещественное число | ° | -180 .. 180 |
| 4  | extGNSSFixAge | вещественное число | сек | ≥ 0 |
| 5  | b1Lat | вещественное число | ° | -90 .. 90 |
| 6  | b1Lon | вещественное число | ° | -180 .. 180 |
| 7  | b1BatState | логическое значение | | true, false |
| 8  | b1DataAge | вещественное число | сек | ≥ 0 |
| 9  | b2Lat | вещественное число | ° | -90 .. 90 |
| 10 | b2Lon | вещественное число | ° | -180 .. 180 |
| 11 | b2BatState | логическое значение | | true, false |
| 12 | b2DataAge | вещественное число | сек | ≥ 0 |
| 13 | b3Lat | вещественное число | ° | -90 .. 90 |
| 14 | b3Lon | вещественное число | ° | -180 .. 180 |
| 15 | b3BatState | логическое значение | | true, false |
| 16 | b3DataAge | вещественное число | сек | ≥ 0 | 
| 17 | b4Lat | вещественное число | ° | -90 .. 90 |
| 18 | b4Lon | вещественное число | ° | -180 .. 180 |
| 19 | b4BatState | логическое значение | | true, false |
| 20 | b4DataAge | вещественное число | сек | ≥ 0 | 
| 21 | tLat | вещественное число | ° | -90 .. 90 |
| 22 | tLon | вещественное число | ° | -180 .. 180 |
| 23 | tDpt | вещественное число | м | |
| 24 | tRErr | вещественное число | м | ≥ 0 |
| 25 | tFixAge | вещественное число | сек | ≥ 0 |
| 26 | tCourseEstimated | вещественное число | ° | 0 .. 360 |
| 27 | tDistance | вещественное число | м | ≥ 0 |
| 28 | tFwdAzimuth | вещественное число | ° | 0 .. 360 |
| 29 | tRevAzimuth | вещественное число | ° | 0 .. 360 |
| 30 | tRelAge | вещественное число | сек | ≥ 0 |
| 31 | DOPState | перечисляемый тип | | |
| 32 | TBAState | перечисляемый тип | | |
| 33 | DOPTBAStateAge | вещественное число | сек | ≥ 0 |

#### Таблица 3.2.2 - Описание параметров сообщения

| № | Параметр | Описание |
| :--- | :--- | :--- | 
| 1  | SntID | Идентификатор сообщения |
| 2  | extGNSSLat | Широта, по данным внешнего GNSS-приемника |
| 3  | extGNSSLon |  Долгота, по данным внешнего GNSS-приемника |
| 4  | extGNSSFixAge | Возраст предыдуших двух полей |
| 5  | b1Lat | Широта (Буй №1) |
| 6  | b1Lon | Долгота (Буй №1) |
| 7  | b1BatState | Признак низкого зарядя встроенного источника питания (Буй №1) |
| 8  | b1DataAge | Возраст предыдущих трех полей |
| 9  | b2Lat | Широта (Буй №2) |
| 10 | b2Lon | Долгота (Буй №2) |
| 11 | b2BatState | Признак низкого зарядя встроенного источника питания (Буй №2) |
| 12 | b2DataAge | Возраст предыдущих трех полей |
| 13 | b3Lat | Широта (Буй №3) |
| 14 | b3Lon | Долгота (Буй №3) |
| 15 | b3BatState | Признак низкого зарядя встроенного источника питания (Буй №3) |
| 16 | b3DataAge | Возраст предыдущих трех полей |
| 17 | b4Lat | Широта (Буй №4) |
| 18 | b4Lon | Долгота (Буй №4) |
| 19 | b4BatState | Признак низкого зарядя встроенного источника питания (Буй №4) |
| 20 | b4DataAge | Возраст предыдущих трех полей |
| 21 | tLat | Вычисленная положение пингера: широта |
| 22 | tLon | Вычисленная положение пингера: долгота |
| 23 | tDpt | Глубина пингера (не используется) |
| 24 | tRErr | Радиальная ошибка при вычислении положения пингера  |
| 25 | tFixAge | Возраст предыдущих четырех полей |
| 26 | tCourseEstimated | Вычисленный (экстраполяция по нескольким точкам) курс движения пингера |
| 27 | tDistance | Вычисленная дальность до пингера (только при наличии внегнего GNSS) |
| 28 | tFwdAzimuth | Вычисленный азимут на пингер (только при наличии внегнего GNSS) |
| 29 | tRevAzimuth | Вычисленный азимут от пингера на базовую станцию (только при наличии внегнего GNSS) |
| 30 | tRelAge | Возраст предыдущих четырех полей |
| 31 | DOPState | Геометрический фактор (Dilution Of Precision) |
| 32 | TBAState | Качество расположения пингера относительно буев |
| 33 | DOPTBAStateAge | Возраст предыдущих двух полей |

#### Таблица 3.2.3 - Разбор примера сообщения

`@WAYU,1,,,,48.976070,44.740137,True,8.7,48.975159,44.741759,True,8.5,48.976304,44.742988,True,8.3,48.977198,44.741365,True,8.0,48.976187,44.741468,NaN,7.3,8.0,236.2,,,,,Excellent,Good,0.0<CR><LF>`

| № | Значение из сообщения | Описание |
| :--- | :--- | :--- | 
| 0  | @WAYU     | Идентификатор отправителя |
| 1  | 1         | Идентификатор сообщения |
| 2  |           | Широта, по данным внешнего GNSS-приемника - нет данных |
| 3  |           | Долгота, по данным внешнего GNSS-приемника - нет данных |
| 4  |           | Возраст предыдуших двух полей - нет данных |
| 5  | 48.976070 | Широта (Буй №1) |
| 6  | 44.740137 | Долгота (Буй №1) |
| 7  | True      | Признак низкого зарядя встроенного источника питания (Буй №1) - True=Требует зарядки |
| 8  | 8.7       | Возраст предыдущих трех полей в секундах |
| 9  | 48.975159 | Широта (Буй №2) |
| 10 | 44.741759 | Долгота (Буй №2) |
| 11 | True      | Признак низкого зарядя встроенного источника питания (Буй №2) - True=Требует зарядки |
| 12 | 8.5       | Возраст предыдущих трех полей |
| 13 | 48.976304 | Широта (Буй №3) |
| 14 | 44.742988 | Долгота (Буй №3) |
| 15 | True      | Признак низкого зарядя встроенного источника питания (Буй №3) - True=Требует зарядки |
| 16 | 8.3       | Возраст предыдущих трех полей |
| 17 | 48.977198 | Широта (Буй №4) |
| 18 | 44.741365 | Долгота (Буй №4) |
| 19 | True      | Признак низкого зарядя встроенного источника питания (Буй №4) - True=Требует зарядки |
| 20 | 8.0       | Возраст предыдущих трех полей |
| 21 | 48.976187 | Вычисленная положение пингера: широта |
| 22 | 44.741468 | Вычисленная положение пингера: долгота |
| 23 | NaN       | Глубина пингера (не используется), значение неопределено |
| 24 | 7.3       | Радиальная ошибка при вычислении положения пингера  |
| 25 | 8.0       | Возраст предыдущих четырех полей |
| 26 | 236.2     | Вычисленный (экстраполяция по нескольким точкам) курс движения пингера |
| 27 |           | Вычисленная дальность до пингера (только при наличии внегнего GNSS)  - нет данных |
| 28 |           | Вычисленный азимут на пингер (только при наличии внегнего GNSS) - нет данных |
| 29 |           | Вычисленный азимут от пингера на базовую станцию (только при наличии внегнего GNSS) - нет данных |
| 30 |           | Возраст предыдущих четырех полей |
| 31 | Excellent | Геометрический фактор (Dilution Of Precision) |
| 32 | Good      | Качество расположения пингера относительно буев |
| 33 | 0.0       | Возраст предыдущих двух полей |

<div style="page-break-after: always;"></div>
