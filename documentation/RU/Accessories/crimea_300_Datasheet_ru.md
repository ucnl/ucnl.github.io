| ![logo](https://ucnl.github.io/documentation/sm_logo.png) | ![logo](https://ucnl.github.io/documentation/crm_300.png) |
| :---: | ---: |
| [www.unavlab.com](https://www.unavlab.com/) <br/> [support@unavlab.com](mailto:support@unavlab.com) | **Crimea-300** датчик давления <br/> Спецификация устройства |


## ОСОБЕННОСТИ

* **Минимальные гарабариты и масса**
* **Полное отсутствие корродирующих элементов**
* **Моноблочный литой полиуретановый корпус**
* **Простой NMEA-подобный протокол**

## ОПИСАНИЕ

Датчик абсолютного давления и температуры **Crimea-300** позволяет определять параметры окружающей среды и передавать данные по запросу или независимо. Передача осуществаляется по простому [NMEA-подобному ASCII-протоколу](#%D0%BF%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB-%D1%81%D0%BE%D0%BF%D1%80%D1%8F%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F). Датчики изготавливаются в двух исполнениях: с интерфейсом **UART** и **RS-485**.
  
<div style="page-break-after: always;"></div>

## ТЕХНИЧЕСКИЕ ХАРАКТЕРИСТИКИ

| ПАРАМЕТР | ЗНАЧЕНИЕ |
| :--- | :--- |
| ГАБАРИТЫ (Ф ч х h)| 21 x 50 мм |
| МАКСИМАЛЬНАЯ РАБОЧАЯ ГЛУБИНА | 300 м |
| ДЛИНА КАБЕЛЯ<sup>[2](#footnote2)</sup> | 0.5 м |
| ДИАМЕТР КАБЕЛЯ | 5 мм |
| МАТЕРИАЛ ИЗОЛЯЦИИ КАБЕЛЯ | Полиуретан |
| МАТЕРИАЛ КОРПУСА | Полиуретан |
| ДИАПАЗОН РАБОЧИХ ТЕМПЕРАТУР | -10 .. 60 °С |
| ДИАПАЗОН ИЗМЕРЯЕМЫХ ДАВЛЕНИЙ | 0 .. 30 Бар |
| ПОГРЕШНОСТЬ ИЗМЕРЕНИЯ ДАВЛЕНИЯ (Диапазон 0 .. 6 Бар | +/- 60 мБар |
| ПОГРЕШНОСТЬ ИЗМЕРЕНИЯ ДАВЛЕНИЯ (Диапазон 0 .. 20 Бар | +/- 150 мБар |
| ПОГРЕШНОСТЬ ИЗМЕРЕНИЯ ДАВЛЕНИЯ (Диапазон 0 .. 30 Бар | +/- 350 мБар |
| РАЗРЕШЕНИЕ ПО ДАВЛЕНИЮ | 4 мБар |
| ДИАПАЗОН ИЗМЕРЯЕМЫХ ТЕМПЕРАТУР | -10 .. 60 °С |
| ПОГРЕШНОСТЬ ИЗМЕРЕНИЯ ТЕМПЕРАТУРЫ (Диапазон 0 .. 10 Бар) | +/- 2.5 °С |
| РАЗРЕШЕНИЕ ПО ТЕМПЕРАТУРЕ | 0.1 °C |
| НАПРЯЖЕНИЕ ПИТАНИЯ | 5 .. 12 В |
| ПОТРЕБЛЯЕМЫЙ ТОК | 10 .. 70 мА |
| ВХОДНОЕ НАПРЯЖЕНИЕ ЛИНИЙ ДАННЫХ (исполнение с интерфейсом UART) | 0 .. 3.3 В |
| ВЫХОДНОЕ НАПРЯЖЕНИЕ ЛИНИЙ ДАННЫХ (исполнение с интерфейсом UART) | 0 .. 3.3 В |
| ЦВЕТ КОРПУСА<sup>[3](#footnote1)</sup> | Черный |
| ПРОТОКОЛ СОПРЯЖЕНИЯ | [NMEA0183-подобный](#%D0%BF%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB-%D1%81%D0%BE%D0%BF%D1%80%D1%8F%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F) |

________________
<a name="footnote1"><sup>1</sup></a> С учетом кабеля станартной длины.  
<a name="footnote2"><sup>2</sup></a> Параметр может быть изменен по договоренности.  
<a name="footnote3"><sup>3</sup></a> Указан цвет по умолчанию. Доступны другие цвета: черный, желтный, зеленый, синий. Возможно окрашивание в любой цвет по каталогу RAL при заказе от 50 шт.  

<div style="page-break-after: always;"></div>

## ПРОТОКОЛ СОПРЯЖЕНИЯ

### 1. Общая информация
Датчики Crimea-300 поставляются в двух исполнениях:  
- с электрическим интерфейсом UART
- с электрическим интерфейсом RS-485

> ВНИМАНИЕ! В виду специфики работы протокола RS-485, перевод датчика в циклический режим передачи приведет к тому, что дальнейшее изменение его настроек будет невозможно!

#### 1.1. Протокол физического уровеня
   
В зависимости от исполнения, устройство поддерживает информационное сопряжение:  
- при помощи стандарта физического уровня RS-232 для асинхронного интерфейса (UART) c напряжением линии данных 3.3 Вольт
- при помощи стандарта физического уровня RS-485

Подключение производится при помощи четырехпроводного кабеля:

> **ВНИМАНИЕ!** Переполюсовка и/или подача повышенного напряжения приводит к неустранимой и **негарантийной** поломке устройства!

##### Таблица 1 - Назначение жил кабеля для исполнения с интерфейсом UART 3.3 В (Вариант кабеля 1)

| №| Цвет жилы | Функция | 
| :--- | :--- | :--- |
| 1 | Зеленый | +5 .. + 12 Вольт |
| 2 | Черный | Tx |
| 3 | Белый/Прозрачный | Rx |
| 4 | Оплетка | Общий |

##### Таблица 2 - Назначение жил кабеля для исполнения с интерфейсом UART 3.3 В (Вариант кабеля 2)

| №| Цвет жилы | Функция | 
| :--- | :--- | :--- |
| 1 | Красный | +5 .. + 12 Вольт |
| 2 | Зеленый | Tx |
| 3 | Белый/Прозрачный | Rx |
| 4 | Оплетка | Общий |

> Без применения дополнительных повторителей и преобразователей интерфейса максимальная длинна шины данных для исполнения с интерфейсом UART, для которой гарантируется корректная работа интерфейса, составляет не более 2 метров.  

##### Таблица 3 - Назначение жил кабеля для исполнения с интерфейсом RS-485 (Вариант кабеля 1)

| №| Цвет жилы | Функция | 
| :--- | :--- | :--- |
| 1 | Зеленый | +5 .. + 12 Вольт |
| 2 | Черный | Общий |
| 3 | Белый/Прозрачный | A |
| 4 | Коричневый | B |

##### Таблица 4 - Назначение жил кабеля для исполнения с интерфейсом RS-485 (Вариант кабеля 2)

| №| Цвет жилы | Функция | 
| :--- | :--- | :--- |
| 1 | Красный | +5 .. + 12 Вольт |
| 2 | Зеленый | A |
| 3 | Белый/Прозрачный | B |
| 4 | Оплетка | Общий |

Настройки порта подключения:  
> _Baudrate: 9600 bit/s_  
> _Data bits: 8_  
> _Stop bits: 1_  
> _Parity: No_  
> _Hardware flow control: No_  

#### 1.2. Стандарт протокола диалогового уровня NMEA0183
Стандарт NMEA0183 описывает формат текстовых (ASCII) сообщений диалогового уровня.  

Пример сообщения:  **`$PTNT1,01,00*hh<СR><LF>`**  

Основные элементы посылки (сообщения, sentence) NMEА0183:
* '$' - начало сообщения,
* 'P' - Proprietary, проприетарный код
* 'TNT' - трехбуквенный идентификатор производителя
* '0' - идентификатор сообщения
* ',' - запятая (разделитель параметров)  
* '*' - разделитель контрольной суммы
* 'hh' - контрольная сумма в шестнадцатеричном формате (например FF, 01). Рассчитывается как побитовый XOR всех байт между '$' и '*'.
* \<CR\>\<LF\> - конец сообщения (перевод строки)


<div style="page-break-after: always;"></div>

### 2. Система команд TNT для устройств Crimea-300
Префикс **D2H** в наименовании сообщений означает, что оно передается от устройства (Device) к управляющей системе (Host).
Префикс **H2D** в наименовании сообщений означает, что оно передается от управляющей системы (Host) к устройству (Device).

Если в описании команды параметр определяется как 'xx' это следует понимать как фиксированную ширину поля в 2 символа. Т.е. если требуемое значение 5, то оно должно быть дополнено нулем слева: 05 и т.п.

#### 2.1. IC_D2H_ACK
Сообщение IC_D2H_ACK - реакция устройства на поступивший от управляющей системы запрос  

Формат сообщения: **`$PTNT0,x<CR><LF>`**  

| Поле/Параметр |	Описание |
| :--- | :--- |
| $	| Начало сообщения '$' |
| PTNT	| TNT |
| 0	| Идентификатор сообщения |
| errCode	| Код ошибки \([см. 3.1](#31-%D0%BA%D0%BE%D0%B4%D1%8B-%D0%BE%D1%88%D0%B8%D0%B1%D0%BE%D0%BA)\) |
| \<CR\>\<LF\> | Конец сообщения |

#### 2.2. IC_D2H_PRETMP_VAL
Сообщение IC_D2H_PRETMP_VAL - показания давления и температуры

Формат сообщения: **`$PTNTO,x.x,x.x<CR><LF>`**  

| Поле/Параметр |	Описание |
| :--- | :--- |
| $	| Начало сообщения '$' |
| PTNT	| TNT |
| O	| Идентификатор сообщения |
| pressure_mBar	| Абсолютное давление в мБар, вещественное число |
| temp_C | Температура в °C, вещественное число
| \<CR\>\<LF\> | Конец сообщения |

#### 2.3. IC_H2D_FLD_SET
Сообщение IC_H2D_FLD_SET - задание значения настроечного поля. При успешной установке нового значение устройство передает сообщение [IC_D2H_FLD_VAL](#24-ic_d2h_fld_val), иначе - код ошибки при помощи сообщения [IC_D2H_ACK](#21-ic_d2h_ack)

Формат сообщения: **`$PTNT2,xx,xx<CR><LF>`**  

| Поле/Параметр |	Описание |
| :--- | :--- |
| $	| Начало сообщения '$' |
| PTNT	| TNT |
| 2	| Идентификатор сообщения |
| fldID	| Идентификатор поля \([см. 3.2.](#32-%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B5%D1%87%D0%BD%D1%8B%D0%B5-%D0%BF%D0%BE%D0%BB%D1%8F)\) |
| fldNewValue | Новое значение поля \([см. 3.2.](#32-%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B5%D1%87%D0%BD%D1%8B%D0%B5-%D0%BF%D0%BE%D0%BB%D1%8F)\) |
| \<CR\>\<LF\> | Конец сообщения |

#### 2.4. IC_D2H_FLD_VAL
Сообщение IC_D2H_FLD_VAL - значение настроечного поля.

Формат сообщения: **`$PTNT3,xx,xx<CR><LF>`**  

| Поле/Параметр |	Описание |
| :--- | :--- |
| $	| Начало сообщения '$' |
| PTNT	| TNT |
| 3	| Идентификатор сообщения |
| fldID	| Идентификатор поля \([см. 3.2.](#32-%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B5%D1%87%D0%BD%D1%8B%D0%B5-%D0%BF%D0%BE%D0%BB%D1%8F)\) |
| fldNewValue | Новое значение поля \([см. 3.2.](#32-%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B5%D1%87%D0%BD%D1%8B%D0%B5-%D0%BF%D0%BE%D0%BB%D1%8F)\) |
| \<CR\>\<LF\> | Конец сообщения |

#### 2.5. IC_H2D_ACT_INVOKE
Запрос на выполнение сервисной операции.

Формат сообщения: **`$PTNT6,xx,00<CR><LF>`**  

| Поле/Параметр |	Описание |
| :--- | :--- |
| $	| Начало сообщения '$' |
| PTNT	| TNT |
| 6	| Идентификатор сообщения |
| actID	| Идентификатор операции \([см. 3.3.](#33-%D0%B8%D0%B4%D0%B5%D0%BD%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%82%D0%BE%D1%80%D1%8B-%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%BD%D1%8B%D1%85-%D0%BE%D0%BF%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D0%B9)\) |
| reserved | '00' - зарезервировано |
| \<CR\>\<LF\> | Конец сообщения |

#### 2.6. IC_H2D_LOC_DATA_GET
Запрос значения локального параметра. В зависимости от идентификатора данных устройство отвечает сообщением [IC_D2H_LOC_DATA_VAL](#27-ic_h2d_loc_data_val) или [IC_D2H_PRETMP_VAL](#22-ic_d2h_pretmp_val), если идентификатор данных соответствует [DATA_ID_PRETMP](#34-%D0%B8%D0%B4%D0%B5%D0%BD%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%82%D0%BE%D1%80%D1%8B-%D0%BB%D0%BE%D0%BA%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D1%85-%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D0%BE%D0%B2).

Формат сообщения: **`$PTNT4,xx,00<CR><LF>`**  

| Поле/Параметр |	Описание |
| :--- | :--- |
| $	| Начало сообщения '$' |
| PTNT	| TNT |
| 4	| Идентификатор сообщения |
| dataID | Идентификатор параметра \([см. 3.4.](#34-%D0%B8%D0%B4%D0%B5%D0%BD%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%82%D0%BE%D1%80%D1%8B-%D0%BB%D0%BE%D0%BA%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D1%85-%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D0%BE%D0%B2)\) |
| reserved | '00' - зарезервировано |
| \<CR\>\<LF\> | Конец сообщения |

#### 2.7. IC_H2D_LOC_DATA_VAL
Значение локального параметра.

Формат сообщения: **`$PTNT5,xx,x.x<CR><LF>`**  

| Поле/Параметр |	Описание |
| :--- | :--- |
| $	| Начало сообщения '$' |
| PTNT	| TNT |
| 5	| Идентификатор сообщения |
| 4	| Идентификатор сообщения |
| dataID | Идентификатор параметра \([см. 3.4.](#34-%D0%B8%D0%B4%D0%B5%D0%BD%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%82%D0%BE%D1%80%D1%8B-%D0%BB%D0%BE%D0%BA%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D1%85-%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D0%BE%D0%B2)\) |
| dataValue | Значение параметра |
| \<CR\>\<LF\> | Конец сообщения |

### 3. Таблицы идентификаторов

#### 3.1. Коды ошибок

| № | Код ошибки | Описание |
| :--- | :--- | :--- |
| 1 | 0 | Нет ошибки |
| 2 | 1 | Ошибка синтаксиса |
| 3 | 2 | Параметр вне диапазона допустимых значений |
| 4 | 3 | Ошибка датчика |
| 5 | 4 | Запрос не поддерживается |

#### 3.2. Настроечные поля

| № | Идентификатор поля | Наименование | Диапазон значений | Описание |
| :--- | :--- | :--- | :--- | :--- |
| 1 | 0 | CFLD_DATA_CHANNEL_BAUDRATE | 0 - 1200 b/s <br/> 1 - 2400 b/s <br/> 2 - 4800 b/s <br/> 3 - 9600 b/s <br/> 4 - 19200 b/s <br/> 5 - 38400 b/s <br/> 6 - 57600 b/s <br/> 7 - 115200 b/s | Скорость порта |
| 2 | 1 | CFLD_DATA_CHANNEL_PARITY | 0 - None <br/> 1 - Even <br/> 2 - Odd <br/> | Контроль четности |
| 3 | 2 | CFLD_DATA_CHANNEL_MODE | 0 - работа по запросу <br/> 1 - циклическая передача (без запроса) | Режим передачи показаний |

#### 3.3. Идентификаторы сервисных операций

| № | Код операции | Описание |
| :--- | :--- | :--- |
| 1 | 0 | Сохранение настроек в энергонезависимую память |
| 2 | 1 | Сброс настроек в энергонезависимой памяти |
| 3 | 2 | Перезагрузка устройства |

#### 3.4. Идентификаторы локальных параметров

| № | Идентификатор | Описание |
| :--- | :--- | :--- |
| 1 | 0 | - |
| 2 | 1 | DATA_ID_PML | Верхний предел измеряемого давления, мБар |
| 3 | 2 | DATA_ID_TML | Верхний передел измеряемой температуры, °С |
| 4 | 3 | DATA_ID_DATA_UPDATE_RATE_MS | Период измерений (не выдачи!) давления и температуры |
| 5 | 4 | - |
| 6 | 5 | - |
| 7 | 6 | DATA_ID_PRETMP | Инициирует передачу сообщения [IC_D2H_PRETMP_VAL](#22-ic_d2h_pretmp_val) |

### 4. Примеры

В примерах сообщения, передаваемые от пользовательской системы датчику обозначены префиксом **>>**, а сообщения, передаваемые датчиком - префиксом **<<**.
Символы признака конца сообщения NMEA0183 показаны как <CR><LF> - Carrige return, Line Feed (0x0D, 0x0A).

#### 4.1. Задание режима передачи

Датчик подключен к управляющей системе. Его режим работы по умолчанию - по запросу.  

```
>> $PTNT2,02,01<CR><LF>          // задать занчение поля №2 (CFLD_DATA_CHANNEL_MODE) равным 1 (1 - циклическая передача (без запроса)  
<< $PNTN3,02,01<CR><LF>          // поле №2 имеет значение 1  
>> $PTNT6,00,00<CR><LF>          // сохранить текущие настройки в энергонезависимую память  
<< $PTNT0,0<CR><LF>              // ACK, запрос принят, операция выполнена успешно  
<< $PTNTO,1023.260,28.12<CR><LF> // Данные о давлении и температуре: 1023.26 мБар, 28.12 °С  
<< $PTNTO,1022.870,28.20<CR><LF> // Данные о давлении и температуре: 1022.87 мБар, 28.20 °С  
...  
```

> ВНИМАНИЕ! При задании циклического режима передачи для устройств в исполнении с интерфейсом RS-485 следует помнить, что после начала передачи датчик будет постоянно занимать линию передачей показаний и изменение настроек будет практически невозможно.

#### 4.2. Запрос давления и температуры

Датчик подключен к управляющей системе. Режим работы по умолчанию - по запросу.

```
>> $PTNT4,06,00<CR><LF>          // Запрос показаний температуры и давления
<< $PTNTO,1023.260,28.12<CR><LF> // Данные о давлении и температуре: 1023.26 мБар, 28.12 °С  
>> $PTNT4,06,00<CR><LF>          // Запрос показаний температуры и давления
>> $PTNTO,1022.870,28.20<CR><LF> // Данные о давлении и температуре: 1022.87 мБар, 28.20 °С  
...  
```

<div style="page-break-after: always;"></div>

## ДОПОЛНИТЕЛЬНЫЕ МАТЕРИАЛЫ

| |
| :---: |
| ![crm_300_drawings_ru.png](https://ucnl.github.io/documentation/crm_300_drawings_ru.png) |
| **Габаритный чертеж** |

<div style="page-break-after: always;"></div>

## ОГРАНИЧЕНИЯ

- Датчик не предназначен для длительного (более месяца) расположения в подводном положении. Длительное пребывание в агрессивных средах, таких, как морская вода приводит к разъеданию защитного компаунда на рабочем теле датчика. Процесс идет быстрее при повышенных давлении и температуре.
- В окно датчика не должны попадать посторонние предметы: песок, ил, водоросли и т.п. При попадании посторонних предметов в окно датчика его следует промыть в пресной воде. Механическая очистка не допускается.


<div style="page-break-after: always;"></div>
