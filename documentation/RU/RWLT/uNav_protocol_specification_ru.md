[Главная](/README_RU) ❯ [Гидроакустические навигационные и трекинговые системы](/navigation_and_tracking_systems_ru) ❯ **Описание протокола сопряжения: uNav**

<div style="page-break-after: always;"></div>

| ![logo](/documentation/sm_logo.png) | ![image](https://github.com/ucnl/ucnl.github.io/assets/24439946/90cb2dba-5bac-46da-bcab-e4880fd4277a) |
| :---: | ---: |
| [www.unavlab.com](https://www.unavlab.com/) <br/> [support@unavlab.com](mailto:support@unavlab.com) | **uNav** - навигационный приемник для трекинговых систем RWLT/WAYU <br/> Протокол информационного сопряжения |
  
# uNav <br/> протокол информационного сопряжения

<div style="page-break-after: always;"></div>

## Содержание

- [1. Введение](#1-%D0%B2%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5)
  - [1.0. Протокол физического уровня](#10-%D0%BF%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB-%D1%84%D0%B8%D0%B7%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B3%D0%BE-%D1%83%D1%80%D0%BE%D0%B2%D0%BD%D1%8F)
  - [1.1. Стандарт протокола диалогового уровня NMEA0183](#11-%D1%81%D1%82%D0%B0%D0%BD%D0%B4%D0%B0%D1%80%D1%82-%D0%BF%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB%D0%B0-%D0%B4%D0%B8%D0%B0%D0%BB%D0%BE%D0%B3%D0%BE%D0%B2%D0%BE%D0%B3%D0%BE-%D1%83%D1%80%D0%BE%D0%B2%D0%BD%D1%8F-nmea0183)
- [2. Система команд UNV](#2-%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0-%D0%BA%D0%BE%D0%BC%D0%B0%D0%BD%D0%B4-unv)
   - [2.0. UNV0 - Настройки](#20-unv0---%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B8)
   - [2.1. UNV1 - Опорная точка](#21-unv1---%D0%BE%D0%BF%D0%BE%D1%80%D0%BD%D0%B0%D1%8F-%D1%82%D0%BE%D1%87%D0%BA%D0%B0)
   - [2.2. UNV2 - Глубина и температура воды](#22-unv2---%D0%B3%D0%BB%D1%83%D0%B1%D0%B8%D0%BD%D0%B0-%D0%B8-%D1%82%D0%B5%D0%BC%D0%BF%D0%B5%D1%80%D0%B0%D1%82%D1%83%D1%80%D0%B0-%D0%B2%D0%BE%D0%B4%D1%8B)
   - [2.3. UNV3 - Положение нумерованного объекта](#23-unv3---%D0%BF%D0%BE%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BD%D1%83%D0%BC%D0%B5%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D0%BE%D0%B3%D0%BE-%D0%BE%D0%B1%D1%8A%D0%B5%D0%BA%D1%82%D0%B0)
   - [2.4. UNV4 - Параметры относительно опорной точки](#24-unv4---%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D1%8B-%D0%BE%D1%82%D0%BD%D0%BE%D1%81%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D0%BE-%D0%BE%D0%BF%D0%BE%D1%80%D0%BD%D0%BE%D0%B9-%D1%82%D0%BE%D1%87%D0%BA%D0%B8)
   - [2.5. UNV5 - Данные от встроенного GNSS-приемника](#25-unv5---%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D0%B5-%D0%BE%D1%82-%D0%B2%D1%81%D1%82%D1%80%D0%BE%D0%B5%D0%BD%D0%BD%D0%BE%D0%B3%D0%BE-gnss-%D0%BF%D1%80%D0%B8%D0%B5%D0%BC%D0%BD%D0%B8%D0%BA%D0%B0)
   - [2.6. UNV6 - Данные от пингера RWLT](#26-unv6---%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D0%B5-%D0%BE%D1%82-%D0%BF%D0%B8%D0%BD%D0%B3%D0%B5%D1%80%D0%B0-rwlt)
 - [3. Прочие сообщения](#3-%D0%BF%D1%80%D0%BE%D1%87%D0%B8%D0%B5-%D1%81%D0%BE%D0%BE%D0%B1%D1%89%D0%B5%D0%BD%D0%B8%D1%8F)
   - [3.0. GGA](#30-gga)
   - [3.1. RMC](#31-rmc)
   - [3.2. APLA - Пакет данных от навигационного буя WAYU](#32-apla---%D0%BF%D0%B0%D0%BA%D0%B5%D1%82-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85-%D0%BE%D1%82-%D0%BD%D0%B0%D0%B2%D0%B8%D0%B3%D0%B0%D1%86%D0%B8%D0%BE%D0%BD%D0%BD%D0%BE%D0%B3%D0%BE-%D0%B1%D1%83%D1%8F-wayu)
   - [3.3. RWLA - Пакет данных от навигационного буя RWLT](#33-rwla---%D0%BF%D0%B0%D0%BA%D0%B5%D1%82-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85-%D0%BE%D1%82-%D0%BD%D0%B0%D0%B2%D0%B8%D0%B3%D0%B0%D1%86%D0%B8%D0%BE%D0%BD%D0%BD%D0%BE%D0%B3%D0%BE-%D0%B1%D1%83%D1%8F-rwlt)

<div style="page-break-after: always;"></div>

## 0. История версий и список изменений
[История версий и изменений](uNav_version_history_ru.md)

<div style="page-break-after: always;"></div>

## 1. Введение
### 1.0. Протокол физического уровня
   
Устройства uNav поддерживают информационное сопряжение при помощи последовательного интерфейса.

Настройки порта подключения по умолчанию:  
> _Baudrate: 38400 bit/s_  
> _Data bits: 8_  
> _Stop bits: 1_  
> _Parity: No_  
> _Hardware flow control: No_  


### 1.1. Стандарт протокола диалогового уровня NMEA0183
Стандарт NMEA0183 описывает формат текстовых (ASCII) сообщений диалогового уровня.  

Пример сообщения:  **`$PUNA0,1,0*hh<СR><LF>`**  

Основные элементы посылки (сообщения, sentence) NMEА0183:
* '$' - начало сообщения,
* 'P' - Proprietary, проприетарный код
* 'UNV' - трехбуквенный идентификатор
* '0' - идентификатор сообщения
* ',' - запятая (разделитель параметров)  
* '*' - разделитель контрольной суммы
* 'hh' - контрольная сумма в шестнадцатеричном формате (например FF, 01). Рассчитывается как побитовый XOR всех байт между '$' и '*'.
* \<CR\>\<LF\> - конец сообщения (перевод строки)


<div style="page-break-after: always;"></div>

## 2. Система команд UNV

Устройство и система команд для взаимодействия с ним спроектированы так, чтобы его можно было единожды настроив, подключать к различным пиложениям, предназначенным для работы с приемниками GNSS. В большей части устройство использует стандартные сообщения протокола NMEA: RMC и GGA. 

### 2.0. UNV0 - Настройки
Сообщение UNV0 служит для задания настроек устройству, запроса текущих настроек и передачи текущих настроек от устройства.

Формат сообщения: **`$PUNV0,x.x,x.x,x.x,x.x,x,x.x,x,x.x,x,x*hh<CR><LF>`**  

| № | Поле/Параметр |	Описание |
| :--- | :--- | :--- |
| | $	| Начало сообщения '$' |
| | PUNV	| UNV |
| | 0	| Идентификатор сообщения |
| 1 | sty_PSU	| Соленость воды в PSU, 0 .. 40 PSU |
| 2 | wtmp_C	| Температура воды в °C, -4 .. 46 °С |
| 3 | sos_mps	| Скорость звука в воде в м/с, 1300 .. 1600 м/с |
| 4 | max_tspd_mps | Максимальная скорость движения в м/с, 0.5 .. 5 м/с |
| 5 | sf_FIFO_size | Размер буфера сглаживающего фильтра, 2 .. 64 |
| 6 | sf_rthld_m | Порог сброса сглаживающего фильтра, 5 .. 1000 м |
| 7 | dhf_FIFO_size | Размер буфера-классификатора, 2 .. 64 |
| 8 | dhf_rthld | Порог буфера-классификатора, 5 .. 1000 м |
| 9 | ce_FIFO_size | Размер буфера определителя курса движения, 2 .. 64 |
| 10 | brate | Скорость порта (см. ..) |
| 11 | rwlt_mode | Режим работы (для системы RWLT). Пустое поле или 0 - пингер, 1 - дайверы |
| 12 | rwlt_drating | Максимальная глубина пингера (для системы RWLT). 0 - 300, 1 - 500, 2 - 1000 м |
| *	| Разделитель контрольной суммы NMEA |
| hh	| Контрольная сумма NMEA |
| \<CR\>\<LF\> | Конец сообщения |

### 2.1. UNV1 - Опорная точка
Команда служит для задания опорной точки, относительно которой устройство может рассчитывать курс и дальность до позиционируемого объекта.
 
Формат сообщения: **`$PUWV1,x,x.x,x.x*hh<CR><LF>`**

| № | Поле/Параметр |	Описание |
| :--- | :--- | :--- |
| | $	| Начало сообщения '$' |
| | PUNV	| UNV |
| | 1	| Идентификатор сообщения |
| 1 | ref_point_type | 0 - AUX GNSS, 1-4 base points, empty - user defined |
| 2 | ref_point_lat	| широта, -90.0 .. 90.0 ° |
| 3 | ref_point_lon	| долгота, -180.0 .. 180.0 ° |
| *	| Разделитель контрольной суммы NMEA |
| hh	| Контрольная сумма NMEA |
| \<CR\>\<LF\> | Конец сообщения |

### 2.2. UNV2 - Глубина и температура воды
Команда служит для задания глубины позиционируемого объекта (только для WAYU) и температуры воды.

Формат сообщения: **`$PUWV2,x.x,x.x*hh<CR><LF>`**

| № | Поле/Параметр |	Описание |
| :--- | :--- | :--- |
| | $	| Начало сообщения '$' |
| | PUNV	| UNV |
| | 2	| Идентификатор сообщения |
| 1 | tDpt_m | Глубина позиционируемого объекта, м |
| 2 | wTmp_С	| Температура воды, -4 .. 46 °C |
| *	| Разделитель контрольной суммы NMEA |
| hh	| Контрольная сумма NMEA |
| \<CR\>\<LF\> | Конец сообщения |

### 2.3. UNV3 - Положение нумерованного объекта
Только для системы RWLT, работающей в режиме определения местоположения водолазов. При помощи данного сообщение передаются определяемые навигационные данные нумерованной цели (например, водолаза, оснащенного устройством беспроводной голосовой связи [RedPhone-DX](/documentation/RU/RedPhone
/RedPhone_DX_Specification_ru)).

Формат сообщения: **`$PUWV3,x,x.x,x.x,x.x,x.x,x.x,x.x*hh<CR><LF>`**

| № | Поле/Параметр |	Описание |
| :--- | :--- | :--- |
| | $	| Начало сообщения '$' |
| | PUNV	| UNV |
| | 3	| Идентификатор сообщения |
| 1 | tID | Идентификатор (адрес) объекта |
| 2 | tLat	| Широта, -90.0 .. 90.0 ° |
| 3 | tLon	| Долгота, -180.0 .. 180.0 ° |
| 4 | tDpt	| Глубина, м |
| 5 | tCrs	| Курс, , 0 .. 360.0 ° |
| 6 | tRer	| Радиальная ошибка, м |
| 7 | Age	| Возраст навигационных данных, сек |
| *	| Разделитель контрольной суммы NMEA |
| hh	| Контрольная сумма NMEA |
| \<CR\>\<LF\> | Конец сообщения |

### 2.5. UNV4 - Параметры относительно опорной точки
Сообщение содержит вычисленные навигационные параметры позиционируемого объекта, относительно настроенной опорной точки. 

Формат сообщения: **`$PUWV4,x,x.x,x.x,x.x,x.x,x.x,x.x*hh<CR><LF>`**

| № | Поле/Параметр |	Описание |
| :--- | :--- | :--- |
| | $	| Начало сообщения '$' |
| | PUNV	| UNV |
| | 4	| Идентификатор сообщения |
| 1 | tID | Идентификатор объекта. Для всех случаев кроме работы RWLT в режиме с водолазами, поле остается пустым |
| 2 | rpLt	| Широта опорной точки, -90.0 .. 90.0 ° |
| 3 | rpLn	| Долгота опорной точки, -180.0 .. 180.0 ° |
| 4 | dst2rp	| Дальность до опорной точки на плоскости, м |
| 5 | crs2rp	| Курс от объекта на опорную точку, 0 .. 360.0 ° |
| 6 | crs4rp	| Курс от опорной точки на объект, 0 .. 360.0 ° |
| 7 | Age	| Возраст навигационных данных, сек |
| *	| Разделитель контрольной суммы NMEA |
| hh	| Контрольная сумма NMEA |
| \<CR\>\<LF\> | Конец сообщения |

### 2.6. UNV5 - Данные от встроенного GNSS-приемника
Сообщение содержит навигационные данные от встроенного GNSS-приемника. 

Формат сообщения: **`$PUWV5,x.x,x.x,x.x,x.x*hh<CR><LF>`**

| № | Поле/Параметр |	Описание |
| :--- | :--- | :--- |
| | $	| Начало сообщения '$' |
| | PUNV	| UNV |
| | 5	| Идентификатор сообщения |
| 1 | gnssLt | Географическая широта, -90.0 .. 90.0 ° |
| 2 | gnssLn | Географическая долгота, -180.0 .. 180.0 ° |
| 3 | gnssCrs	| Курс, 0 .. 360.0 ° |
| 4 | gnssSog | Скорость, км/ч |
| *	| Разделитель контрольной суммы NMEA |
| hh	| Контрольная сумма NMEA |
| \<CR\>\<LF\> | Конец сообщения |

### 2.7. UNV6 - Данные от пингера RWLT
Сообщение содержит данные, полученные от пингера RWLT. 

Формат сообщения: **`$PUWV6,x,x.x*hh<CR><LF>`**

| № | Поле/Параметр |	Описание |
| :--- | :--- | :--- |
| | $	| Начало сообщения '$' |
| | PUNV	| UNV |
| | 6	| Идентификатор сообщения |
| 1 | dataID | Идентификатор данных |
| 2 | dataValue | Данные |
| *	| Разделитель контрольной суммы NMEA |
| hh	| Контрольная сумма NMEA |
| \<CR\>\<LF\> | Конец сообщения |

<div style="page-break-after: always;"></div>

## 3. Прочие сообщения

### 3.0. GGA
Стандартное сообщение NMEA0183 - Global positioning system fix data.

Формат сообщения: **`$GNGGA,hhmmss.sss,ddmm.mmm,N|S,yyymm.mmm,E|W,x,xx,x.x,x.x,M,x.x,M,xx,xxxx*hh<CR><LF>`**  

| № | Поле/Параметр |	Описание |
| :--- | :--- | :--- |
| | $	| Начало сообщения '$' |
| | GN | Стандартный источник данных - Global navigation |
| | GGA |	Стандартный идентификатор сообщения - Globap positioning system fix data |
| 1 | UTC Time |	UTC, ччммсс.ссс (по встроенному GNSS-приемнику) |
| 2 | Latitude |	Географическая широта, ddmm.mmmmmm |
| 3 | N|S | Идентификатор полушария, N - северное, S - южное |
| 4 | Longitude |	Географическая долгота, dddmm.mmmmmm |
| 5 | E|W | Идентификатор полушария, E - восточное, W - западное |
| 6 | Fix Type | Тип навигационного решения | 
| 7 | Satellites in view | Число доступных спутников (всегда равно 4) |
| 8 | HDOP | Horizontal dilution of precision, метры. (данное поле передает радиальную ошибку, значение функции невязки в конце решения) |
| 9 | Altitude | Altitude, метры. (данное поле передает глубину, т.е. высоту со знаком "-") |
| 10 | M |	М - метры |
| 11 | Geoidal separation | Поле не поддерживается и остается пустым |
| 12 | Age of data |  Поле не поддерживается и остается пустым |
| 13 | Reference station ID | Поле не поддерживается и остается пустым |
| | *	| Разделитель контрольной суммы NMEA |
| | hh	| Контрольная сумма NMEA |
| | \<CR\>\<LF\> | Конец сообщения |

### 3.1. RMC
Стандартное сообщение NMEA0183 - Recommended minimum, sentence 'C'.

Формат сообщения: **`$GNRMC,hhmmss.sss,A|V,ddmm.mmm,N|S,dddmm.mmm,E|W,x.x,x.x,ddmmyy,,,A|D|V*hh<CR><LF>`**  

| № | Поле/Параметр |	Описание |
| :--- | :--- | :--- |
|  | $	| Начало сообщения '$' |
|  | GN | Стандартный источник данных - Global navigation |
|  | RMC | Стандартный идентификатор сообщения - Recommended minimum, sentence 'C' |
| 1 | UTC Time |	UTC, ччммсс.ссс |
| 2 | Data quality indicator |	A - данные о времени (по встроенному GNSS-приемнику) верны |
| 3 | Latitude |	Географическая широта, ddmm.mmmmmm |
| 4 | N|S | Идентификатор полушария, N - северное, S - южное |
| 5 | Longitude |	Географическая долгота, dddmm.mmmmmm |
| 6 | E|W | Идентификатор полушария, E - восточное, W - западное |
| 7 | Speed |	Поле не поддерживается |
| 8 | Course | Курс движения, градусы |
| 9 | Date | По данным встроенного GNSS-приемника |
| 10 | Magnetic variation | Поле не поддерживается |
| 11 | E|W | Поле не поддерживается |
| 12 | A | Режим, A - GNSS |
|  | *	| Разделитель контрольной суммы NMEA |
|  | hh	| Контрольная сумма NMEA |
|  | \<CR\>\<LF\> | Конец сообщения |

### 3.2. APLA - Пакет данных от навигационного буя WAYU
Данные, полученные от навигационного буя cистемы WAYU (APostLe, сообщение "A").

Формат сообщения: **`$PAPLA,x,x.x,x.x,x,x.x,x.x*hh<CR><LF>`**

| № | Поле/Параметр |	Описание |
| :--- | :--- | :--- |
| | $	| Начало сообщения '$' |
| | PAPLA	| APL |
| | A	| Идентификатор сообщения |
| 1 | bID | Номер (адрес) буя, 1 .. 4 |
| 2 | bLt	| Широта буя, -90.0 .. 90.0 ° |
| 3 | bLn	| Долгота буя, -180.0 .. 180.0 ° |
| 4 | bDpt_m | Глубина погружения акустической антенны, м |
| 5 | bBat | Напряжение питания встроенного источника буя, В |
| 6 | bTOA | Время прихода сигнала на буй, сек, 0 .. 62 |
| *	| Разделитель контрольной суммы NMEA |
| hh	| Контрольная сумма NMEA |
| \<CR\>\<LF\> | Конец сообщения |


### 3.3. RWLA - Пакет данных от навигационного буя RWLT
Данные, полученные от навигационного буя системы RWLT (RWLT, сообщение "A")

Формат сообщения: **`$PRWLA,x,x.x,x.x,x,x.x,x,x.x,x.x*hh<CR><LF>`**

| № | Поле/Параметр |	Описание |
| :--- | :--- | :--- |
| | $	| Начало сообщения '$' |
| | PRWLA	| RWL |
| | A	| Идентификатор сообщения |
| 1 | bID | Номер (адрес) буя, 1 .. 4 |
| 2 | bLt	| Широта буя, -90.0 .. 90.0 ° |
| 3 | bLn	| Долгота буя, -180.0 .. 180.0 ° |
| 4 | bDpt_m | Глубина погружения акустической антенны, м |
| 5 | bBat | Напряжение питания встроенного источника буя, В |
| 6 | pData | Пакет данных от позиционируемого объекта |
| 7 | bTOA | Время прихода сигнала на буй, сек, 0 .. 62 |
| 8 | bMSR | Main peak to side lobe ratio, dB |
| *	| Разделитель контрольной суммы NMEA |
| hh	| Контрольная сумма NMEA |
| \<CR\>\<LF\> | Конец сообщения |


<div style="page-break-after: always;"></div>
  
[Вернуться к содержанию](#%D1%81%D0%BE%D0%B4%D0%B5%D1%80%D0%B6%D0%B0%D0%BD%D0%B8%D0%B5)

